{% extends 'home2.html' %}
{% load static %}

{% block css %}
<link rel="stylesheet" href="{% static 'iscritti.css' %}" media="screen">
{% endblock %}

	{% block navbar %}
	<div class="container">
		<nav class="nav1">
		<ul>
			<li class="nav-item"><a class="a" id="home" href="/home/">Home</a></li>
			<li class="nav-item"><a class="a" href="/info2/">Informazioni</a></li>
			<li class="nav-item"><a class="a active" href="/iscrizioni2/">Iscrizioni</a></li>
			<li class="nav-item"><a class="a" href="/">Logout</a></li>
			<li class="dropdown dropbtn">Appello
				<div class="dropdown-content">
					<a href="/appello/squadra/">Squadra</a>
					<a href="/appello/entrata/">Gestione Presenze</a>
				</div>
			</li>
			<li class="nav-item"><a class="a" href="/classifica/">Classifica</a></li>
			<li class="nav-item"><a class="a" href="/files/">Documenti</a></li>
			<li class="nav-item"><a class="a" href="/admin/">Admin</a></li>
		</ul>
		</nav>
	</div>
		{% endblock %}

		{% block main %}
		<div class="content">
			<h1>Iscritti</h1>
			<div class="toolbar">
				<input type="text" id="searchInput" placeholder="Cerca tra le iscrizioni...">
				<select id="sortSelect">
					<option value="cognome">Ordina per Cognome</option>
					<option value="nome">Ordina per Nome</option>
					<option value="squadra">Ordina per Squadra</option>
				</select>
			</div>
			<div class="elemento" style="overflow-x: auto">
			<table id="iscrittiTable">
				<thead>
					<tr>
						<th>Cognome</th>
						<th>Nome</th>
						<th>Data di nascita</th>
						<th>Squadra</th>
						<th>Uscita Autonoma</th>
						<th>Gita</th>
						<th>Padre</th>
						<th>Madre</th>
						<th>Tutore</th>
						<th>Foto</th>
						<th>Allergie</th>
						<th>Note</th>
					</tr>
				</thead>
				<tbody>
					{% for iscritto in iscritti %}
						<tr>
							<td>{{ iscritto.cognome_figlio }}</td>
							<td>{{ iscritto.nome_figlio }}</td>
							<td>{{ iscritto.data_figlio }}</td>
							<td>{{ iscritto.squadra|default_if_none:"/" }}
							<td>{{ iscritto.uscita_autonoma|yesno:"Sì,No" }}</td>
							<td>{{ iscritto.gita|yesno:"Sì,No" }}
							<td>{{ iscritto.padre|default_if_none:"" }}</td>
							<td>{{ iscritto.madre|default_if_none:"" }}</td>
							<td>{{ iscritto.tutore|default_if_none:"" }}</td>
							<td>{{ iscritto.foto|yesno:"Sì,No" }}</td>
							<td>{{ iscritto.allergie|default_if_none:"" }}</td>
							<td>{{ iscritto.note|default_if_none:"" }}</td>
						</tr>
					{% empty %}
						<tr><td colspan="12">Nessuna iscrizione è ancora stata effettuata.</td></tr>
					{% endfor %}
				</tbody>
			</table>
		</div>
	</div>

	<script>
		document.addEventListener('DOMContentLoaded', function () {
			const searchInput = document.getElementById('searchInput');
			const sortSelect = document.getElementById('sortSelect');
			const table = document.getElementById('iscrittiTable');
			const tbody = table.querySelector('tbody');

			function filterTable() {
				const filter = searchInput.value.toLowerCase();
				const rows = tbody.getElementsByTagName('tr');

				for (let i = 0; i < rows.length; i++) {
					const row = rows[i];
					const cells = row.getElementsByTagName('td');
					let match = false;

					for (let j = 0; j < cells.length; j++) {
						if (cells[j].textContent.toLowerCase().includes(filter)) {
							match = true;
							break;
						}
					}
					row.style.display = match ? '' : 'none';
				}
			}

			function sortTable(columnIndex) {
				const rows = Array.from(tbody.querySelectorAll('tr'));
				const direction = 1; // ascending

				rows.sort((a, b) => {
					const textA = a.cells[columnIndex]?.textContent?.toLowerCase() || '';
					const textB = b.cells[columnIndex]?.textContent?.toLowerCase() || '';
					return textA.localeCompare(textB) * direction;
				});

				rows.forEach(row => tbody.appendChild(row));
			}

			searchInput.addEventListener('input', filterTable);

			sortSelect.addEventListener('change', function () {
				const sortValue = sortSelect.value;
				const columnMap = {
					'cognome': 0,
					'nome': 1,
					'squadra': 3
				};
				const columnIndex = columnMap[sortValue];
				if (columnIndex !== undefined) {
					sortTable(columnIndex);
				}
			});
		});
		</script>
	{% endblock %}